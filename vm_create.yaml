---
- hosts: 127.0.0.1
  user: root

  vars_prompt:
    - name: "vm_ip"
      prompt: "Enter ip for VM"
      private: no

  tasks:
    - name: Create config script
      template: 
        src: templates/vm_conf.j2
        dest: /opt/virt/meta-data/vm_{{ vm_ip }}.sh
        mode: '0654'
        owner: qemu
        group: qemu
        force: yes

    - name: Create VM
      script: /opt/virt/meta-data/vm_{{ vm_ip }}.sh "{{ vm_ip }}"

    - name: Remove script
      command: rm -f /opt/virt/meta-data/vm_{{ vm_ip }}.sh
      